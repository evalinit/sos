class SiteOSClient{constructor(){this.listeners={},this.referrer=null,this.init()}init(){this.setReferrer(),window.addEventListener("message",e=>this.onMessage(e))}onMessage(e){var s=new URL(this.referrer).origin;e.origin===s&&({name:s,args:e}=e.data,s=this.listeners[s])&&s(...e)}setReferrer(){document.referrer&&sessionStorage.setItem("referrer",document.referrer);var e=sessionStorage.getItem("referrer");e&&(this.referrer=e)}postMessage(e){(window.opener||window.parent).postMessage(e,this.referrer)}on(e,s){this.listeners[e]=s}off(e){delete this.listeners[e]}emit(e,...s){this.postMessage({name:e,args:s})}}class SiteOSController{constructor(e){this.url=e,this.origin=new URL(e).origin,this.listeners={},this.instances=[],this.#init()}#init(){window.addEventListener("message",e=>this.#onMessage(e)),this.createInstance()}#onMessage(s){if(s.origin===this.origin){var{name:t,args:i}=s.data,t=this.listeners[t];if(t){let e;for(const r of this.instances)r.target.contentWindow===s.source&&(e=r);t(...i,e)}}}createInstance(){var e=document.createElement("iframe"),e=(e.src=this.url,document.body.appendChild(e),{target:e,type:"iframe",origin:this.origin});return e.listeners={},e.on=function(e,s){this.listeners[e]=s},e.off=function(e){delete this.listeners[e]},e.emit=function(e,...s){this.target.contentWindow.postMessage({name:e,args:s},this.origin)},this.instances.push(e),e}on(e,s){this.listeners[e]=s}off(e){delete this.listeners[e]}emit(e,...s){var t={name:e,args:s};for(const i of this.instances)i.target.contentWindow.postMessage(t,this.origin)}}