class SiteOS{constructor(e){this.apps=e,this.instances={},this.allowedOrigins=new Set,this.init()}init(){window.addEventListener("message",e=>this.onMessage(e));for(var[e,s]of Object.entries(this.apps)){this.registerApp(e,s),this.attachFrame(e,s);e=new URL(s.url);this.allowedOrigins.add(e.origin)}}onMessage(e){if(this.allowedOrigins.has(e.origin)){var s,t,{name:r,args:i}=e.data;for([s,t]of Object.entries(this.instances)){var n,a,o,h=t["frames"];for([n,a]of Object.entries(h))if(a.contentWindow===e.source)return void((o=this[s].listeners[r])&&o(...i,n))}}}registerApp(e,s){s.outerThis=this,s.name=e,s.listeners={},s.on=function(e,s){this.listeners[e]=s},s.off=function(e){delete this.listeners[e]},s.emit=function(e,...s){var t,r,i=this.outerThis.instances[this.name]["frames"],n={name:e,args:s};for([t,r]of Object.entries(i))r.contentWindow.postMessage(n,this.url)},this[e]=s,this.instances[e]={frames:{},tabs:{},count:1}}attachFrame(e,s){var t=document.createElement("iframe"),s=(t.src=s.url,document.body.appendChild(t),this.instances[e]);s.frames[s.count]=t,s.count+=1}}class SiteOSClient{constructor(){this.listeners={},this.referrer=null,this.init()}init(){this.setReferrer(),window.addEventListener("message",e=>this.onMessage(e))}onMessage(e){var s=new URL(this.referrer).origin;e.origin===s&&({name:s,args:e}=e.data,s=this.listeners[s])&&s(...e)}setReferrer(){document.referrer&&sessionStorage.setItem("referrer",document.referrer);var e=sessionStorage.getItem("referrer");e&&(this.referrer=e)}postMessage(e){(window.opener||window.parent).postMessage(e,this.referrer)}on(e,s){this.listeners[e]=s}off(e){delete this.listeners[e]}emit(e,...s){this.postMessage({name:e,args:s})}}