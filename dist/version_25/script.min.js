class SiteOSClient{constructor(){this.listeners={},this.referrer=null,this.init()}init(){this.setReferrer(),window.addEventListener("message",e=>this.onMessage(e))}onMessage(e){var t=new URL(this.referrer).origin;e.origin===t&&({name:t,args:e}=e.data,t=this.listeners[t])&&t(...e)}setReferrer(){document.referrer&&sessionStorage.setItem("referrer",document.referrer);var e=sessionStorage.getItem("referrer");e&&(this.referrer=e)}postMessage(e){(window.opener||window.parent).postMessage(e,this.referrer)}on(e,t){this.listeners[e]=t}off(e){delete this.listeners[e]}emit(e,...t){this.postMessage({name:e,args:t})}}class SiteOSController{constructor(e){this.url=e,this.origin=new URL(e).origin,this.listeners={},this.instances=[],this.hiddenContainerID="site-os-hidden-container",this.#init()}#init(){window.addEventListener("message",e=>this.#onMessage(e)),this.#createHiddenContainer()}#onMessage(t){if(t.origin===this.origin){var{name:s,args:i}=t.data,s=this.listeners[s];if(s){let e;for(const n of this.instances)n.target.contentWindow===t.source&&(e=n);s(...i,e)}}}#createHiddenContainer(){var e;document.getElementById(this.hiddenContainerID)||((e=document.createElement("div")).id=this.hiddenContainerID,e.style.display="none",document.body.appendChild(e))}on(e,t){this.listeners[e]=t}off(e){delete this.listeners[e]}emit(e,...t){var s={name:e,args:t};for(const i of this.instances)i.target.contentWindow.postMessage(s,this.origin)}launch(e){var t=document.createElement("iframe");t.src=this.url,t.style.width="100%",t.style.height="100%";let s;(s=(s=e?document.getElementById(e):s)||document.getElementById(this.hiddenContainerID)).appendChild(t);e={target:t,type:"iframe",origin:this.origin,listeners:{},on:function(e,t){this.listeners[e]=t},off:function(e){delete this.listeners[e]},emit:function(e,...t){this.target.contentWindow.postMessage({name:e,args:t},this.origin)}};return this.instances.push(e),e}}